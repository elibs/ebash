#!/usr/bin/env bash
#
# Copyright 2021, Marshall McMullen <marshall.mcmullen@gmail.com>
#
# This program is free software: you can redistribute it and/or modify it under the terms of the Apache License
# as published by the Apache Software Foundation, either version 2 of the License, or (at your option) any later
# version.

: ${EBASH_HOME:=$(dirname $0)/..}
: ${EBASH:=${EBASH_HOME}/share}
source "${EBASH}/ebash.sh" || { echo "Unable to source ${EBASH}/ebash.sh" ; exit 1 ; }

opt_usage main <<'END'
This script is used to install additional recommended binaries onto a system. This is done using the portable ebash
provided `pkg_install` which deals with the package names across different distros sensibly.
END

#----------------------------------------------------------------------------------------------------------------------
#
# All
#
#----------------------------------------------------------------------------------------------------------------------

OS=$(os_pretty_name)
ebanner --uppercase "Installing recommended packages" \
    OS

# Generic list of packages that are universally named in all distros
packages=(
    bzip2
    cpio
    curl
    dialog
    gettext
    gzip
    jq
    util-linux
)

# Linux-only packages
if os linux; then
    packages+=( squashfs-tools )
fi

#----------------------------------------------------------------------------------------------------------------------
#
# Alpine
#
#----------------------------------------------------------------------------------------------------------------------

if os_distro alpine; then

    packages+=(
        cdrkit
        debootstrap
        git
        gnupg
        iproute2
        iputils
        ncurses
        ncurses-terminfo
        net-tools
        pstree
        xz
    )

#----------------------------------------------------------------------------------------------------------------------
#
# Arch
#
#----------------------------------------------------------------------------------------------------------------------

elif os_distro arch; then

    packages+=(
        cdrkit
        debootstrap
        git
        net-tools
    )

#----------------------------------------------------------------------------------------------------------------------
#
# CentOS
#
#----------------------------------------------------------------------------------------------------------------------

elif os_distro centos; then

    packages+=(
        debootstrap
        genisoimage
        git
        iproute
        iptables
        ncurses
        net-tools
        psmisc
        xz
    )

#----------------------------------------------------------------------------------------------------------------------
#
# Debian
#
#----------------------------------------------------------------------------------------------------------------------

elif os_distro debian; then

    packages+=(
        apt-transport-https
        debootstrap
        genisoimage
        git
        iproute2
        iptables
        net-tools
        psmisc
        software-properties-common
        xz-utils
    )

#----------------------------------------------------------------------------------------------------------------------
#
# Fedora
#
#----------------------------------------------------------------------------------------------------------------------

elif os_distro fedora; then

    packages+=(
        debootstrap
        genisoimage
        git
        iproute
        iptables
        iputils
        ncurses
        net-tools
        psmisc
        xz
    )

#----------------------------------------------------------------------------------------------------------------------
#
# Gentoo
#
#----------------------------------------------------------------------------------------------------------------------

elif os_distro gentoo; then

    packages+=(
        cdrtools
        debootstrap
        dev-vcs/git
        lbzip2
        net-tools
        pigz psmisc
    )

#----------------------------------------------------------------------------------------------------------------------
#
# Ubuntu
#
#----------------------------------------------------------------------------------------------------------------------

elif os_distro ubuntu; then

    packages+=(
        cgroup-lite
        debootstrap
        git
        gnupg-agent
        iproute2
        iptables
        iputils-ping
        mkisofs
        net-tools
        psmisc
        xz-utils
    )

#----------------------------------------------------------------------------------------------------------------------
#
# MacOS (Darwin)
#
#----------------------------------------------------------------------------------------------------------------------

elif os darwin; then

    packages+=(
        git
        gnu-tar
        iproute2mac
    )

fi

#----------------------------------------------------------------------------------------------------------------------
#
# INSTALL
#
#----------------------------------------------------------------------------------------------------------------------

array_sort --unique packages
pkg_install --sync "${packages[@]}"
